<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Word Swipe Cards</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #f2f2f2;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  overflow: hidden;
  transition: background 0.3s;
}

body.dark {
  background: #111;
}

.container {
  width: 100%;
  max-width: 400px;
  height: 90vh;
  position: relative;
}

.card {
  width: 100%;
  height: 75%;
  border-radius: 20px;
  padding: 25px;
  box-sizing: border-box;
  color: white;
  position: absolute;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  text-align: center;
  box-shadow: 0 15px 30px rgba(0,0,0,0.3);
  transition: transform 0.3s ease, opacity 0.3s ease;
  touch-action: none;
}

.card.behind {
  transform: scale(0.95) translateY(15px);
  opacity: 0.8;
}

.word {
  font-size: 34px;
  font-weight: bold;
}

.details {
  margin-top: 20px;
  display: none;
  font-size: 16px;
}

.controls {
  position: absolute;
  bottom: 0;
  width: 100%;
  display: flex;
  justify-content: space-around;
  padding: 10px 0;
}

button {
  padding: 10px 14px;
  border-radius: 10px;
  border: none;
  font-size: 16px;
  cursor: pointer;
}

body.dark button {
  background: #333;
  color: white;
}
</style>
</head>

<body>
<div class="container">
  <div class="card behind" id="nextCard"></div>
  <div class="card" id="currentCard"></div>

  <div class="controls">
    <button onclick="toggleFavorite()" id="favBtn">‚≠ê</button>
    <button onclick="toggleShuffle()">üîÄ</button>
    <button onclick="toggleDark()">üåô</button>
    <button onclick="speakWord()">üîä</button>
  </div>
</div>

<script>
let words = [];
let current = 0;
let shuffled = false;
let favorites = JSON.parse(localStorage.getItem("favorites")) || [];
let darkMode = localStorage.getItem("darkMode") === "true";

let startX = 0;
let currentX = 0;
let isDragging = false;

const currentCard = document.getElementById("currentCard");
const nextCard = document.getElementById("nextCard");
const favBtn = document.getElementById("favBtn");

if(darkMode){
  document.body.classList.add("dark");
}

function randomColor() {
  return `hsl(${Math.random()*360},70%,60%)`;
}

fetch("words.json")
  .then(res => res.json())
  .then(data => {
    words = data;
    renderCards();
  });

function renderCards() {
  const wordObj = words[current];

  currentCard.style.background = randomColor();
  currentCard.innerHTML = `
    <div class="word">${wordObj.word}</div>
    <div class="details">
      <b>Meaning:</b> ${wordObj.meaning}<br>
      <b>Local:</b> ${wordObj.local}<br><br>
      ${wordObj.sentences.map(s => "- "+s).join("<br>")}
    </div>
  `;

  const nextIndex = (current + 1) % words.length;
  nextCard.style.background = randomColor();
  nextCard.innerHTML = `<div class="word">${words[nextIndex].word}</div>`;

  updateFavoriteButton();
}

function updateFavoriteButton(){
  if(favorites.includes(current)){
    favBtn.textContent = "‚ù§Ô∏è";
  } else {
    favBtn.textContent = "‚≠ê";
  }
}

currentCard.addEventListener("click", (e) => {
  if(isDragging) return;
  const details = currentCard.querySelector(".details");
  if(details)
    details.style.display =
      details.style.display === "block" ? "none" : "block";
});

function nextWord() {
  current = shuffled
    ? Math.floor(Math.random() * words.length)
    : (current + 1) % words.length;
  resetCard();
  renderCards();
}

function toggleShuffle() {
  shuffled = !shuffled;
  alert("Shuffle: " + (shuffled ? "ON" : "OFF"));
}

function toggleFavorite(){
  if(favorites.includes(current)){
    favorites = favorites.filter(i => i !== current);
  } else {
    favorites.push(current);
  }
  localStorage.setItem("favorites", JSON.stringify(favorites));
  updateFavoriteButton();
}

function toggleDark(){
  document.body.classList.toggle("dark");
  localStorage.setItem("darkMode",
    document.body.classList.contains("dark"));
}

function speakWord() {
  const utter = new SpeechSynthesisUtterance(words[current].word);
  speechSynthesis.speak(utter);
}

/* üî• FIXED SWIPE (Touch + Mouse) */

function startDrag(x){
  startX = x;
  isDragging = true;
}

function moveDrag(x){
  if(!isDragging) return;
  currentX = x - startX;
  currentCard.style.transform =
    `translateX(${currentX}px) rotate(${currentX/12}deg)`;
}

function endDrag(){
  if(!isDragging) return;
  isDragging = false;

  if(Math.abs(currentX) > 120){
    currentCard.style.opacity = "0";
    currentCard.style.transform =
      `translateX(${currentX > 0 ? 600 : -600}px) rotate(${currentX/8}deg)`;
    setTimeout(nextWord, 300);
  } else {
    resetCard();
  }
}

function resetCard(){
  currentCard.style.opacity = "1";
  currentCard.style.transform = "translateX(0) rotate(0)";
  currentX = 0;
}

/* Touch */
currentCard.addEventListener("touchstart", e =>
  startDrag(e.touches[0].clientX));

currentCard.addEventListener("touchmove", e =>
  moveDrag(e.touches[0].clientX));

currentCard.addEventListener("touchend", endDrag);

/* Mouse (Desktop support) */
currentCard.addEventListener("mousedown", e =>
  startDrag(e.clientX));

window.addEventListener("mousemove", e =>
  moveDrag(e.clientX));

window.addEventListener("mouseup", endDrag);

</script>
</body>
</html>