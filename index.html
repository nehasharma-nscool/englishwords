<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Premium Word Deck</title>

<style>
body{
  margin:0;
  font-family:Arial;
  background:#f2f2f2;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  overflow:hidden;
  transition:.3s;
}
body.dark{ background:#111; }

.container{
  width:100%;
  max-width:420px;
  height:95vh;
  position:relative;
}

/* ===== Progress ===== */
.progress{
  position:absolute;
  top:10px;
  left:50%;
  transform:translateX(-50%);
  background:rgba(0,0,0,.7);
  color:white;
  padding:6px 14px;
  border-radius:20px;
  font-size:14px;
  z-index:10;
}

/* ===== Jump ===== */
.jumpBox{
  position:absolute;
  top:50px;
  left:50%;
  transform:translateX(-50%);
  z-index:10;
}
.jumpBox input{
  width:60px;
  padding:4px;
  border-radius:8px;
  border:none;
  text-align:center;
}

/* ===== Deck ===== */
.deck{
  position:relative;
  height:75%;
  margin-top:90px;
}

/* ===== Card ===== */
.card{
  width:88%;
  left:6%;
  height:100%;
  border-radius:22px;
  padding:25px;
  box-sizing:border-box;
  color:white;
  position:absolute;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  text-align:center;
  box-shadow:0 20px 40px rgba(0,0,0,.3);
  transition:transform .35s cubic-bezier(.25,.8,.25,1),
             opacity .35s ease;
  will-change:transform;
  touch-action:none;
}

.card:nth-child(1){ z-index:3; }
.card:nth-child(2){
  transform:scale(.95) translateY(15px);
  opacity:.9; z-index:2;
}
.card:nth-child(3){
  transform:scale(.9) translateY(30px);
  opacity:.8; z-index:1;
}

.word{ font-size:28px; font-weight:bold; }
.details{ display:none; margin-top:18px; font-size:15px; }

/* ===== Controls ===== */
.controls{
  position:absolute;
  bottom:0;
  width:100%;
  display:flex;
  justify-content:space-around;
  padding:10px 0;
}
button{
  padding:8px 12px;
  border:none;
  border-radius:10px;
  font-size:14px;
}
</style>
</head>
<body>

<div class="container">
  <div class="progress" id="progress"></div>

  <div class="jumpBox">
    <input type="number" id="jumpInput" placeholder="#" min="1">
    <button onclick="jumpTo()">Go</button>
  </div>

  <div class="deck" id="deck"></div>

  <div class="controls">
    <button onclick="toggleFavorite()" id="favBtn">‚≠ê</button>
    <button onclick="toggleLearned()" id="learnBtn">üéØ</button>
    <button onclick="toggleShuffle()">üîÄ</button>
    <button onclick="toggleDark()">üåô</button>
  </div>
</div>

<script>
let words=[]
let deckOrder=[]
let currentIndex=0
let favorites=JSON.parse(localStorage.getItem("favorites"))||[]
let learned=JSON.parse(localStorage.getItem("learned"))||[]
let shuffle=false

const deck=document.getElementById("deck")
const progress=document.getElementById("progress")

fetch("words.json")
.then(r=>r.json())
.then(data=>{
  words=data
  buildDeck()
})

function randomColor(){
  return `hsl(${Math.random()*360},70%,60%)`
}

function buildDeck(){
  let base=words.map((_,i)=>i)
  base=base.filter(i=>!learned.includes(i))
  deckOrder=shuffle?shuffleArray(base):[...base]
  currentIndex=0
  renderDeck()
}

function shuffleArray(arr){
  let a=[...arr]
  for(let i=a.length-1;i>0;i--){
    let j=Math.floor(Math.random()*(i+1))
    ;[a[i],a[j]]=[a[j],a[i]]
  }
  return a
}

function renderDeck(){
  deck.innerHTML=""
  for(let i=0;i<3;i++){
    if(currentIndex+i>=deckOrder.length) break
    let index=deckOrder[currentIndex+i]
    let card=createCard(words[index],index)
    deck.appendChild(card)
  }
  updateProgress()
}

function createCard(wordObj,index){
  let card=document.createElement("div")
  card.className="card"
  card.style.background=randomColor()
  card.innerHTML=`
    <div class="word">${wordObj.word}</div>
    <div class="details">
      <b>Meaning:</b> ${wordObj.meaning}<br>
      <b>Local:</b> ${wordObj.local}<br><br>
      ${wordObj.sentences.map(s=>"- "+s).join("<br>")}
    </div>
  `
  card.addEventListener("click",()=>{
    let d=card.querySelector(".details")
    d.style.display=d.style.display==="block"?"none":"block"
  })
  addSwipe(card)
  return card
}

/* ===== Ultra Smooth Swipe ===== */
function addSwipe(card){
  let startX=0,currentX=0,drag=false

  function start(x){
    drag=true
    startX=x
    card.style.transition="none"
  }

  function move(x){
    if(!drag) return
    currentX=x-startX
    let rotate=currentX/15
    card.style.transform=
      `translateX(${currentX}px) rotate(${rotate}deg)`
  }

  function end(){
    if(!drag) return
    drag=false
    card.style.transition=
      "transform .35s cubic-bezier(.25,.8,.25,1), opacity .35s"

    if(currentX>130){
      swipeNext(card)
    }
    else if(currentX<-130){
      swipePrev(card)
    }
    else{
      card.style.transform="translateX(0) rotate(0)"
    }
  }

  card.addEventListener("touchstart",e=>start(e.touches[0].clientX))
  card.addEventListener("touchmove",e=>move(e.touches[0].clientX))
  card.addEventListener("touchend",end)

  card.addEventListener("mousedown",e=>start(e.clientX))
  window.addEventListener("mousemove",e=>move(e.clientX))
  window.addEventListener("mouseup",end)
}

function swipeNext(card){
  card.style.transform="translateX(600px) rotate(30deg)"
  card.style.opacity="0"
  setTimeout(()=>{
    currentIndex++
    if(currentIndex>=deckOrder.length)
      currentIndex=0
    renderDeck()
  },300)
}

function swipePrev(card){
  card.style.transform="translateX(-600px) rotate(-30deg)"
  card.style.opacity="0"
  setTimeout(()=>{
    currentIndex--
    if(currentIndex<0)
      currentIndex=deckOrder.length-1
    renderDeck()
  },300)
}

function updateProgress(){
  progress.innerText=
    `${currentIndex+1} / ${deckOrder.length}`
}

/* ===== Jump ===== */
function jumpTo(){
  let val=parseInt(document.getElementById("jumpInput").value)
  if(val>=1 && val<=deckOrder.length){
    currentIndex=val-1
    renderDeck()
  }
}

/* ===== Extra Controls ===== */
function toggleFavorite(){
  let idx=deckOrder[currentIndex]
  if(favorites.includes(idx))
    favorites=favorites.filter(i=>i!==idx)
  else favorites.push(idx)
  localStorage.setItem("favorites",JSON.stringify(favorites))
}

function toggleLearned(){
  let idx=deckOrder[currentIndex]
  if(learned.includes(idx))
    learned=learned.filter(i=>i!==idx)
  else learned.push(idx)
  localStorage.setItem("learned",JSON.stringify(learned))
  buildDeck()
}

function toggleShuffle(){
  shuffle=!shuffle
  buildDeck()
}

function toggleDark(){
  document.body.classList.toggle("dark")
}
</script>

</body>
</html>