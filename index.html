<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advanced Word Deck</title>

<style>
body{
  margin:0;
  font-family:Arial;
  background:#f2f2f2;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  overflow:hidden;
  transition:.3s;
}
body.dark{ background:#111; }

.container{
  width:100%;
  max-width:400px;
  height:92vh;
  position:relative;
}

.progress{
  position:absolute;
  top:10px;
  width:100%;
  text-align:center;
  font-weight:bold;
}

.deck{ position:relative; height:75%; }

.card{
  width:100%;
  height:100%;
  border-radius:20px;
  padding:25px;
  box-sizing:border-box;
  color:white;
  position:absolute;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  text-align:center;
  box-shadow:0 15px 30px rgba(0,0,0,.3);
  transition:transform .3s ease, opacity .3s ease;
  touch-action:none;
}

.card:nth-child(1){ z-index:3; }
.card:nth-child(2){
  transform:scale(.95) translateY(15px);
  opacity:.9; z-index:2;
}
.card:nth-child(3){
  transform:scale(.9) translateY(30px);
  opacity:.8; z-index:1;
}

.word{ font-size:30px; font-weight:bold; }
.details{ display:none; margin-top:20px; font-size:15px; }

.controls{
  position:absolute;
  bottom:0;
  width:100%;
  display:flex;
  justify-content:space-around;
  padding:10px 0;
}
button{
  padding:8px 12px;
  border:none;
  border-radius:10px;
  font-size:14px;
}
</style>
</head>
<body>

<div class="container">
  <div class="progress" id="progress"></div>
  <div class="deck" id="deck"></div>

  <div class="controls">
    <button onclick="toggleFavorite()" id="favBtn">‚≠ê</button>
    <button onclick="toggleLearned()" id="learnBtn">üéØ</button>
    <button onclick="toggleFavMode()" id="modeBtn">üìä</button>
    <button onclick="toggleShuffle()" id="shuffleBtn">üîÄ</button>
    <button onclick="toggleDark()">üåô</button>
  </div>
</div>

<script>
let words=[]
let deckOrder=[]
let currentIndex=0

let favorites=JSON.parse(localStorage.getItem("favorites"))||[]
let learned=JSON.parse(localStorage.getItem("learned"))||[]
let dark=localStorage.getItem("dark")==="true"
let shuffle=false
let favMode=false

if(dark) document.body.classList.add("dark")

const deck=document.getElementById("deck")
const progress=document.getElementById("progress")
const favBtn=document.getElementById("favBtn")
const learnBtn=document.getElementById("learnBtn")
const modeBtn=document.getElementById("modeBtn")
const shuffleBtn=document.getElementById("shuffleBtn")

fetch("words.json")
.then(r=>r.json())
.then(data=>{
  words=data
  buildDeck()
})

function randomColor(){
  return `hsl(${Math.random()*360},70%,60%)`
}

function buildDeck(){
  let base = words.map((_,i)=>i)

  if(favMode)
    base = base.filter(i=>favorites.includes(i))

  base = base.filter(i=>!learned.includes(i))

  if(base.length===0){
    progress.innerText="No words available"
    deck.innerHTML=""
    return
  }

  if(shuffle){
    deckOrder=shuffleArray(base)
  } else {
    deckOrder=[...base]
  }

  currentIndex=0
  animateReshuffle()
}

function shuffleArray(arr){
  let a=[...arr]
  for(let i=a.length-1;i>0;i--){
    let j=Math.floor(Math.random()*(i+1))
    ;[a[i],a[j]]=[a[j],a[i]]
  }
  return a
}

function animateReshuffle(){
  deck.style.transform="scale(.9)"
  deck.style.opacity="0"
  setTimeout(()=>{
    deck.style.transform="scale(1)"
    deck.style.opacity="1"
    renderDeck()
  },250)
}

function renderDeck(){
  deck.innerHTML=""
  for(let i=0;i<3;i++){
    if(currentIndex+i>=deckOrder.length) break
    let index=deckOrder[currentIndex+i]
    let card=createCard(words[index], index)
    deck.appendChild(card)
  }
  updateUI()
}

function createCard(wordObj, index){
  let card=document.createElement("div")
  card.className="card"
  card.style.background=randomColor()
  card.innerHTML=`
    <div class="word">${wordObj.word}</div>
    <div class="details">
      <b>Meaning:</b> ${wordObj.meaning}<br>
      <b>Local:</b> ${wordObj.local}<br><br>
      ${wordObj.sentences.map(s=>"- "+s).join("<br>")}
    </div>
  `
  card.addEventListener("click",()=>{
    let d=card.querySelector(".details")
    d.style.display=d.style.display==="block"?"none":"block"
  })
  addSwipe(card)
  return card
}

function addSwipe(card){
  let startX=0,currentX=0,drag=false
  function start(x){ drag=true; startX=x }
  function move(x){
    if(!drag) return
    currentX=x-startX
    card.style.transform=
      `translateX(${currentX}px) rotate(${currentX/10}deg)`
  }
  function end(){
    if(!drag) return
    drag=false
    if(currentX>120) swipeNext(card)
    else if(currentX<-120) swipePrev(card)
    else card.style.transform="translateX(0)"
  }
  card.addEventListener("touchstart",e=>start(e.touches[0].clientX))
  card.addEventListener("touchmove",e=>move(e.touches[0].clientX))
  card.addEventListener("touchend",end)
  card.addEventListener("mousedown",e=>start(e.clientX))
  window.addEventListener("mousemove",e=>move(e.clientX))
  window.addEventListener("mouseup",end)
}

function swipeNext(card){
  card.style.transform="translateX(600px) rotate(25deg)"
  card.style.opacity="0"
  setTimeout(()=>{
    currentIndex++
    if(currentIndex>=deckOrder.length){
      if(shuffle) deckOrder=shuffleArray(deckOrder)
      currentIndex=0
    }
    renderDeck()
  },200)
}

function swipePrev(card){
  card.style.transform="translateX(-600px) rotate(-25deg)"
  card.style.opacity="0"
  setTimeout(()=>{
    currentIndex--
    if(currentIndex<0)
      currentIndex=deckOrder.length-1
    renderDeck()
  },200)
}

function updateUI(){
  if(deckOrder.length===0) return
  let wordIndex=deckOrder[currentIndex]
  progress.innerText=
    `${currentIndex+1} / ${deckOrder.length}`

  favBtn.innerText=
    favorites.includes(wordIndex)?"‚ù§Ô∏è":"‚≠ê"

  learnBtn.innerText=
    learned.includes(wordIndex)?"‚úÖ":"üéØ"

  modeBtn.style.background=
    favMode?"#4CAF50":""
  shuffleBtn.style.background=
    shuffle?"#4CAF50":""
}

function toggleFavorite(){
  let idx=deckOrder[currentIndex]
  if(favorites.includes(idx))
    favorites=favorites.filter(i=>i!==idx)
  else favorites.push(idx)
  localStorage.setItem("favorites",JSON.stringify(favorites))
  updateUI()
}

function toggleLearned(){
  let idx=deckOrder[currentIndex]
  if(learned.includes(idx))
    learned=learned.filter(i=>i!==idx)
  else learned.push(idx)
  localStorage.setItem("learned",JSON.stringify(learned))
  buildDeck()
}

function toggleShuffle(){
  shuffle=!shuffle
  buildDeck()
}

function toggleFavMode(){
  favMode=!favMode
  buildDeck()
}

function toggleDark(){
  document.body.classList.toggle("dark")
  localStorage.setItem("dark",
    document.body.classList.contains("dark"))
}
</script>
</body>
</html>